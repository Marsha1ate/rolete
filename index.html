<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–†—É–ª–µ—Ç–∫–∞üíñ</title>
<style>
:root {
  --reel-width: clamp(60px, 18vw, 90px);
  --reel-height: clamp(90px, 25vw, 130px);
  --symbol-size: clamp(2rem, 6vw, 3rem);
  --button-font: clamp(1rem, 3.5vw, 1.3rem);
  --button-padding: clamp(10px, 3vw, 14px) clamp(25px, 7vw, 40px);
}

body {
  background: radial-gradient(circle at center, #0037a3, #000);
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  color: white;
  font-family: "Segoe UI", sans-serif;
  text-align: center;
  padding: 0 5vw;
}

h1 {
  margin-bottom: 4vh;
  font-size: clamp(1.6rem, 6vw, 2.5rem);
  text-shadow: 0 0 15px rgba(255,255,255,0.6);
}

.machine {
  display: flex;
  justify-content: center;
  background: linear-gradient(180deg, #ffd700, #cfa300);
  border-radius: 20px;
  padding: clamp(15px, 4vw, 25px) clamp(10px, 3vw, 15px);
  box-shadow: 0 0 25px rgba(255,215,0,0.6);
}

.reel {
  width: var(--reel-width);
  height: var(--reel-height);
  overflow: hidden;
  border-radius: 10px;
  margin: 0 clamp(6px, 2vw, 12px);
  background: radial-gradient(circle, #ffffff 0%, #e0e0e0 80%);
  position: relative;
}

.symbols {
  position: absolute;
  top: 0;
  width: 100%;
}

.symbol {
  height: calc(var(--reel-height) * 0.65);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--symbol-size);
}

button {
  margin-top: 4vh;
  font-size: var(--button-font);
  padding: var(--button-padding);
  border: none;
  border-radius: 12px;
  background: #fff;
  color: #333;
  font-weight: bold;
  cursor: pointer;
  transition: transform 0.2s, background 0.2s;
}

button:hover {
  transform: scale(1.05);
  background: #f0f0f0;
}

button:disabled {
  opacity: 0.6;
  cursor: default;
}

.message {
  margin-top: 3vh;
  font-size: clamp(1rem, 4vw, 1.4rem);
  min-height: 1.5em;
}

.hint-box {
  margin-top: 2vh;
  font-size: clamp(1rem, 4vw, 1.2rem);
  transition: all 0.4s ease-in-out;
}

.instruction {
  margin-top: 2vh;
  font-size: clamp(0.9rem, 3.5vw, 1.1rem);
  opacity: 0.8;
  line-height: 1.4em;
}

.exit {
  margin-top: 4vh;
  background: #ff4444;
  color: white;
}
</style>
</head>
<body>
<h1>üé∞ –†—É–ª–µ—Ç–∫–∞ –ª—é–±–≤–∏</h1>

<div class="machine">
  <div class="reel"><div class="symbols" id="r1"></div></div>
  <div class="reel"><div class="symbols" id="r2"></div></div>
  <div class="reel"><div class="symbols" id="r3"></div></div>
</div>

<button id="spin">–ö—Ä—É—Ç–∏—Ç—å</button>
<div class="message" id="msg"></div>
<div class="hint-box" id="hint"></div>
<div class="instruction">
  –ß—Ç–æ–±—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É, –≤—ã–±–µ–π 4 —Ä–∞–∑–∞ –¥–∂–µ–∫–ø–æ—Ç –∏ –ø–æ–ª—É—á–∏—à—å 4 —Å–ª–æ–≤–∞.<br>
  –ò–ª–∏, –µ—Å–ª–∏ –Ω–∞–π–¥—ë—à—å —Ä–∞–Ω—å—à–µ ‚Äî –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
</div>
<button class="exit" id="exit">–í—ã—Ö–æ–¥</button>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const symbols = ["‚ù§Ô∏è","üíé","üçÄ","‚≠ê"];
    const reels = [document.getElementById("r1"), document.getElementById("r2"), document.getElementById("r3")];
    const msg = document.getElementById("msg");
    const hintBox = document.getElementById("hint");
    const btn = document.getElementById("spin");
    const exitBtn = document.getElementById("exit");

    const hints = ["–ø–æ—Å–º–æ—Ç—Ä–∏ –ø–æ–¥ –ø–æ–¥—É—à–∫–æ–π", "–∑–µ–ª–µ–Ω–æ–π", "—à–∫–∞—Ñ", "–Ω–∞–≤–µ—Ä—Ö—É"];
    let jackpots = 0;
    let SYMBOL_HEIGHT;

    function updateSymbolHeight() {
        const reel = document.querySelector(".reel");
        SYMBOL_HEIGHT = reel.offsetHeight * 0.65;
    }
    window.addEventListener("resize", updateSymbolHeight);
    updateSymbolHeight();

    const TOTAL = symbols.length;

    function init() {
        reels.forEach(reel => {
            reel.innerHTML = "";
            for (let i = 0; i < 30; i++) {
                const el = document.createElement("div");
                el.className = "symbol";
                el.textContent = symbols[i % TOTAL];
                reel.appendChild(el);
            }
        });
    }
    init();

    async function spin() {
        btn.disabled = true;
        msg.textContent = "üí´ –ö—Ä—É—Ç–∏—Ç—Å—è...";

        reels.forEach(reel => {
            reel.style.transition = "none";
            reel.style.transform = "translateY(0)";
        });
        await new Promise(r => setTimeout(r, 50));

        const intervals = [];
        reels.forEach(reel => {
            let current = 0;
            const interval = setInterval(() => {
                current = (current + 1) % TOTAL;
                const offset = (current * SYMBOL_HEIGHT) % (TOTAL * SYMBOL_HEIGHT);
                reel.style.transform = `translateY(-${offset}px)`;
            }, 20);
            intervals.push(interval);
        });

        const results = [];
        for (let i = 0; i < reels.length; i++) {
            await new Promise(r => setTimeout(r, 900));
            clearInterval(intervals[i]);
            const stopIndex = Math.floor(Math.random() * TOTAL);
            reels[i].style.transition = "transform 0.8s ease-out";
            reels[i].style.transform = `translateY(-${stopIndex * SYMBOL_HEIGHT}px)`;
            results.push(symbols[stopIndex]);
        }

        await new Promise(r => setTimeout(r, 1200));

        if (results[0] === results[1] && results[1] === results[2]) {
            jackpots++;
            msg.textContent = `üéâ –î–∂–µ–∫–ø–æ—Ç #${jackpots}! –û—Ç–ª–∏—á–Ω–æ!`;
            if (jackpots <= hints.length) hintBox.textContent = `–ü–æ–¥—Å–∫–∞–∑–∫–∞ ${jackpots}: ${hints[jackpots-1]}`;

            if (jackpots >= 4) {
                msg.textContent = "üéÅ –ü—Ä–∏–∑ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–¥ –∑–µ–ª–µ–Ω–æ–π –ø–æ–¥—É—à–∫–æ–π –Ω–∞–≤–µ—Ä—Ö—É –±–µ–ª–æ–≥–æ —à–∫–∞—Ñ–∞!";
                btn.disabled = true;
            }

            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.sendData("jackpot" + jackpots);
            }
        } else {
            msg.textContent = "üòÖ –ù–µ –ø–æ–≤–µ–∑–ª–æ, –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞!";
        }

        btn.disabled = jackpots >= 4 ? true : false;
    }

    btn.addEventListener("click", spin);

    // ================= –ö–Ω–æ–ø–∫–∞ –í—ã—Ö–æ–¥ =================
    if (window.Telegram?.WebApp) {
        const tg = window.Telegram.WebApp;
        if (tg.ready) tg.ready(); // –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

        exitBtn.addEventListener("click", () => {
            tg.sendData("exit"); // –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –±–æ—Ç—É
            tg.close();           // –∑–∞–∫—Ä—ã—Ç–∏–µ –º–∏–Ω–∏–∞–ø–ø
        });
    } else {
        exitBtn.addEventListener("click", () => {
            alert("–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ (WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)");
        });
    }
});
</script>
</body>
</html>
